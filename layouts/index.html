{{ define "main" }}
  {{ $paginator := .Paginator }}
  {{ $pageIndex := $paginator.PageNumber }}
  {{ $totalPages := $paginator.TotalPages }}
  {{ $cols := 5.0 }}
  {{ $rows := math.Ceil (div $totalPages $cols) }}
  {{ $row := math.Ceil (div $pageIndex $cols) }}
  {{ $startPage := sub (mul $row $cols) $cols }}
  {{ $endPage := add $startPage $cols }}

  {{ range $paginator.Pages }}
    <a class="home-card" href="{{ .RelPermalink }}">
      <div class="home-card-content">
        <div class="home-card-content-title">{{ .Title | htmlEscape | safeHTML }}</div>
        <span class="home-card-content-date"><time>{{ .Date.Format "2006-01-02" }}</time>
          {{ range .Params.tags }}
            <span class="article-tag">{{ . }}</span>
          {{ end }}
        </span>
        <div class="home-card-content-body">{{ .Plain | safeHTML | truncate 140 }}</div>
        {{ if .Params.img }}
          <figure>
            {{ $imgurl := lower .Params.img }}
            {{ if and (not (hasPrefix $imgurl "http://")) (not (hasPrefix $imgurl "https://")) }}
            {{ $imgurl = path.Join .RelPermalink .Params.img }}
            {{ end }}
            <img width=100% src="{{ $imgurl | relURL }}">
          </figure>
        {{ end }}
      </div>
    </a>
  {{ end }}

  {{ if gt $paginator.TotalPages 1 }}
    <div class="pagination">
      <ul>
        {{ if gt $row 1 }}
          <li><a href="{{ $paginator.Prev.URL }}" class="previous_page">&laquo;</a></li>
        {{ end }}

        {{ range $paginator.Pagers }}
          {{ if and (gt .PageNumber $startPage) (le .PageNumber $endPage) }}
            {{ $active := "" }}
            {{ if eq .PageNumber $paginator.PageNumber }}
              {{ $active = "active" }}
            {{ end }}
            <li><a class="{{ $active }}" href="{{ .URL }}">{{ .PageNumber }}</a></li>
          {{ end }}
        {{ end }}

        {{ if lt $row $rows }}
          <li><a href="{{ $paginator.Next.URL }}" class="next_page">&raquo;</a></li>
        {{ end }}
      </ul>
    </div>
  {{ end }}

{{ end }}